# EmberGuard AI - æ£€æµ‹ä½¿ç”¨æŒ‡å—

## ğŸ”¥ YOLO+LSTMç«ç¾æ£€æµ‹ç³»ç»Ÿ

æœ¬ç³»ç»Ÿæä¾›ä¸¤ç§ä½¿ç”¨æ–¹å¼ï¼š
1. **å‘½ä»¤è¡Œè„šæœ¬** - å¿«é€Ÿæ£€æµ‹å›¾ç‰‡/è§†é¢‘/æ‘„åƒå¤´
2. **GUIç•Œé¢** - å¯è§†åŒ–æ“ä½œç•Œé¢

---

## æ–¹å¼1ï¼šå‘½ä»¤è¡Œæ£€æµ‹ â­ æ¨è

### è„šæœ¬ï¼š`scripts/8_detect_with_lstm.py`

### åŸºæœ¬ç”¨æ³•

```bash
# æ£€æµ‹å›¾ç‰‡
python scripts/8_detect_with_lstm.py --source test_picture/1.png

# æ£€æµ‹è§†é¢‘
python scripts/8_detect_with_lstm.py --source datasets/fire_videos_organized/mixed/archive_fire\ and\ smoke.mp4

# æ£€æµ‹æ‘„åƒå¤´
python scripts/8_detect_with_lstm.py --source 0

# ä¿å­˜ç»“æœ
python scripts/8_detect_with_lstm.py --source test_picture/1.png --output result.jpg

# ä¸æ˜¾ç¤ºçª—å£ï¼ˆåå°è¿è¡Œï¼‰
python scripts/8_detect_with_lstm.py --source video.mp4 --output result.mp4 --no-show
```

### å®Œæ•´å‚æ•°

```bash
python scripts/8_detect_with_lstm.py \
    --source <è¾“å…¥æº> \              # å¿…éœ€ï¼šå›¾ç‰‡/è§†é¢‘è·¯å¾„æˆ–æ‘„åƒå¤´ID
    --yolo <YOLOæ¨¡å‹è·¯å¾„> \          # å¯é€‰ï¼šé»˜è®¤ runs/detect/train2/weights/best.pt
    --lstm <LSTMæ¨¡å‹è·¯å¾„> \          # å¯é€‰ï¼šé»˜è®¤ models/lstm/train/best.pt
    --output <è¾“å‡ºè·¯å¾„> \            # å¯é€‰ï¼šä¿å­˜ç»“æœ
    --conf <ç½®ä¿¡åº¦é˜ˆå€¼> \            # å¯é€‰ï¼šé»˜è®¤ 0.25
    --no-show                        # å¯é€‰ï¼šä¸æ˜¾ç¤ºçª—å£
```

### ä½¿ç”¨ç¤ºä¾‹

#### 1. æ£€æµ‹å•å¼ å›¾ç‰‡

```bash
python scripts/8_detect_with_lstm.py --source test_picture/1.png
```

**è¾“å‡º**:
```
============================================================
æ£€æµ‹å›¾ç‰‡: test_picture/1.png
============================================================

ğŸ”¥ æ£€æµ‹ç»“æœ:
============================================================

ğŸ“¹ YOLOæ£€æµ‹:
  - fire: ç½®ä¿¡åº¦ 0.867

ğŸ§  LSTMé¢„æµ‹:
  - ç±»åˆ«: ç«ç„°
  - ç½®ä¿¡åº¦: 1.000
  - æ¦‚ç‡åˆ†å¸ƒ:
    æ— ç«: 0.000
    çƒŸé›¾: 0.000
    ç«ç„°: 1.000

ğŸ’¾ ç»“æœå·²ä¿å­˜: result.jpg
```

#### 2. æ£€æµ‹è§†é¢‘å¹¶ä¿å­˜

```bash
python scripts/8_detect_with_lstm.py \
    --source datasets/fire_videos_organized/mixed/archive_fire\ and\ smoke.mp4 \
    --output detection_saves/result.mp4
```

**è¾“å‡º**:
```
============================================================
æ£€æµ‹è§†é¢‘: datasets/fire_videos_organized/mixed/archive_fire and smoke.mp4
============================================================

ğŸ“¹ è§†é¢‘ä¿¡æ¯:
  - åˆ†è¾¨ç‡: 1920x1080
  - å¸§ç‡: 25 fps
  - æ€»å¸§æ•°: 1474
  - æ—¶é•¿: 58.9 ç§’

ğŸš€ å¼€å§‹æ£€æµ‹...
============================================================
  è¿›åº¦: 1474/1474 (100.0%)

============================================================
ğŸ”¥ æ£€æµ‹å®Œæˆ
============================================================

ğŸ“Š ç»Ÿè®¡ç»“æœ:
  - å¤„ç†å¸§æ•°: 1474

ğŸ§  LSTMé¢„æµ‹åˆ†å¸ƒ:
  - æ— ç«: 673 (46.6%)
  - çƒŸé›¾: 166 (11.5%)
  - ç«ç„°: 606 (41.9%)

âœ… æœ€ç»ˆåˆ¤æ–­: æ— ç« (å‡ºç° 673 æ¬¡)

ğŸ’¾ ç»“æœå·²ä¿å­˜: detection_saves/result.mp4
```

#### 3. å®æ—¶æ‘„åƒå¤´æ£€æµ‹

```bash
python scripts/8_detect_with_lstm.py --source 0
```

**æ“ä½œ**:
- æŒ‰ `q` é€€å‡º
- æŒ‰ `s` æˆªå›¾ä¿å­˜åˆ° `detection_saves/`

#### 4. åªä½¿ç”¨YOLOï¼ˆä¸ç”¨LSTMï¼‰

```bash
python scripts/8_detect_with_lstm.py --source test_picture/1.png --lstm ""
```

---

## æ–¹å¼2ï¼šGUIç•Œé¢

### å¯åŠ¨GUI

```bash
python scripts/5_run_gui.py
```

### GUIåŠŸèƒ½

1. **æ–‡ä»¶æ£€æµ‹**
   - ç‚¹å‡»"é€‰æ‹©æ–‡ä»¶"æŒ‰é’®
   - é€‰æ‹©å›¾ç‰‡æˆ–è§†é¢‘
   - ç‚¹å‡»"å¼€å§‹æ£€æµ‹"

2. **æ‘„åƒå¤´æ£€æµ‹**
   - ç‚¹å‡»"æ‘„åƒå¤´æ£€æµ‹"æ ‡ç­¾
   - é€‰æ‹©æ‘„åƒå¤´ID
   - ç‚¹å‡»"å¼€å§‹æ£€æµ‹"

3. **å±å¹•æ£€æµ‹**
   - ç‚¹å‡»"å±å¹•æ£€æµ‹"æ ‡ç­¾
   - é€‰æ‹©å±å¹•åŒºåŸŸ
   - ç‚¹å‡»"å¼€å§‹æ£€æµ‹"

### GUIç‰¹ç‚¹

- âœ… å¯è§†åŒ–æ“ä½œç•Œé¢
- âœ… å®æ—¶æ˜¾ç¤ºæ£€æµ‹ç»“æœ
- âœ… æ”¯æŒæ‹–æ‹½æ–‡ä»¶
- âœ… è‡ªåŠ¨ä¿å­˜æ£€æµ‹ç»“æœ
- âš ï¸ ç›®å‰GUIåªæ”¯æŒYOLOæ£€æµ‹ï¼ŒLSTMé›†æˆå¼€å‘ä¸­

---

## æ£€æµ‹æ¨¡å¼å¯¹æ¯”

| ç‰¹æ€§ | çº¯YOLO | YOLO+LSTM |
|------|--------|-----------|
| é€Ÿåº¦ | å¿« | è¾ƒæ…¢ï¼ˆéœ€è¦30å¸§ï¼‰ |
| å‡†ç¡®ç‡ | ä¸­ç­‰ | é«˜ |
| è¯¯æŠ¥ç‡ | è¾ƒé«˜ | ä½ |
| é€‚ç”¨åœºæ™¯ | å®æ—¶æ£€æµ‹ | è§†é¢‘åˆ†æ |
| å›¾ç‰‡æ£€æµ‹ | âœ… | âœ…ï¼ˆé‡å¤30æ¬¡ï¼‰ |
| è§†é¢‘æ£€æµ‹ | âœ… | âœ… æ¨è |
| æ‘„åƒå¤´æ£€æµ‹ | âœ… | âœ… |

### æ¨èä½¿ç”¨åœºæ™¯

**ä½¿ç”¨çº¯YOLO**:
- éœ€è¦å¿«é€Ÿå“åº”
- å®æ—¶ç›‘æ§
- èµ„æºå—é™

**ä½¿ç”¨YOLO+LSTM**:
- è§†é¢‘åˆ†æ
- éœ€è¦é«˜å‡†ç¡®ç‡
- å¯ä»¥æ¥å—å»¶è¿Ÿï¼ˆ30å¸§ï¼‰

---

## æ¨¡å‹é€‰æ‹©

### YOLOæ¨¡å‹

```bash
# ä½¿ç”¨ç¬¬ä¸€è½®è®­ç»ƒçš„æ¨¡å‹
--yolo runs/detect/train2/weights/best.pt

# ä½¿ç”¨å…¶ä»–æ¨¡å‹
--yolo models/yolo11n.pt
```

### LSTMæ¨¡å‹

```bash
# ä½¿ç”¨ç¬¬ä¸€è½®è®­ç»ƒçš„æ¨¡å‹ï¼ˆé»˜è®¤ï¼‰
--lstm models/lstm/train/best.pt

# ä½¿ç”¨ç¬¬äºŒè½®è®­ç»ƒçš„æ¨¡å‹
--lstm models/lstm/train2/best.pt

# ä¸ä½¿ç”¨LSTM
--lstm ""
```

---

## è¾“å‡ºè¯´æ˜

### æ£€æµ‹ç»“æœ

**YOLOæ£€æµ‹**:
- æ£€æµ‹åˆ°çš„ç›®æ ‡ç±»åˆ«ï¼ˆfire/smokeï¼‰
- ç½®ä¿¡åº¦ï¼ˆ0-1ï¼‰
- è¾¹ç•Œæ¡†ä½ç½®

**LSTMé¢„æµ‹**:
- é¢„æµ‹ç±»åˆ«ï¼ˆæ— ç«/çƒŸé›¾/ç«ç„°ï¼‰
- ç½®ä¿¡åº¦ï¼ˆ0-1ï¼‰
- ä¸‰ä¸ªç±»åˆ«çš„æ¦‚ç‡åˆ†å¸ƒ

### å¯è§†åŒ–

æ£€æµ‹ç»“æœä¼šåœ¨å›¾åƒä¸Šç»˜åˆ¶ï¼š
- ğŸ”´ çº¢è‰²æ¡†ï¼šç«ç„°ï¼ˆfireï¼‰
- ğŸŸ¡ é»„è‰²æ¡†ï¼šçƒŸé›¾ï¼ˆsmokeï¼‰
- ğŸŸ¢ ç»¿è‰²æ–‡å­—ï¼šLSTMé¢„æµ‹ç»“æœ

---

## å¸¸è§é—®é¢˜

### 1. LSTMæ¨¡å‹ä¸å­˜åœ¨

**é—®é¢˜**: `âš ï¸  LSTMæ¨¡å‹ä¸å­˜åœ¨: models/lstm/train/best.pt`

**è§£å†³**: 
```bash
# è®­ç»ƒLSTMæ¨¡å‹
python scripts/4_train_lstm.py --epochs 50

# æˆ–è€…ä¸ä½¿ç”¨LSTM
python scripts/8_detect_with_lstm.py --source test.jpg --lstm ""
```

### 2. æ‘„åƒå¤´æ— æ³•æ‰“å¼€

**é—®é¢˜**: `âŒ æ— æ³•æ‰“å¼€æ‘„åƒå¤´: 0`

**è§£å†³**:
- æ£€æŸ¥æ‘„åƒå¤´æ˜¯å¦è¢«å…¶ä»–ç¨‹åºå ç”¨
- å°è¯•å…¶ä»–æ‘„åƒå¤´IDï¼ˆ1, 2...ï¼‰
- æ£€æŸ¥æ‘„åƒå¤´é©±åŠ¨

### 3. è§†é¢‘æ£€æµ‹å¾ˆæ…¢

**åŸå› **: LSTMéœ€è¦å¤„ç†30å¸§åºåˆ—

**è§£å†³**:
- ä½¿ç”¨GPUåŠ é€Ÿï¼ˆå¦‚æœæœ‰CUDAï¼‰
- é™ä½è§†é¢‘åˆ†è¾¨ç‡
- ä¸ä½¿ç”¨LSTMï¼ˆ`--lstm ""`ï¼‰

### 4. æ£€æµ‹ç»“æœä¸å‡†ç¡®

**åŸå› **: 
- YOLOæ¨¡å‹ç½®ä¿¡åº¦é˜ˆå€¼å¤ªä½/å¤ªé«˜
- LSTMæ¨¡å‹è®­ç»ƒä¸è¶³

**è§£å†³**:
```bash
# è°ƒæ•´ç½®ä¿¡åº¦é˜ˆå€¼
python scripts/8_detect_with_lstm.py --source test.jpg --conf 0.5

# ä½¿ç”¨æ›´å¥½çš„LSTMæ¨¡å‹
python scripts/8_detect_with_lstm.py --source test.jpg --lstm models/lstm/train2/best.pt
```

---

## æ€§èƒ½ä¼˜åŒ–

### 1. ä½¿ç”¨GPUåŠ é€Ÿ

ç¡®ä¿å®‰è£…äº†CUDAç‰ˆæœ¬çš„PyTorchï¼š
```bash
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118
```

### 2. é™ä½åˆ†è¾¨ç‡

ä¿®æ”¹YOLOæ£€æµ‹åˆ†è¾¨ç‡ï¼š
```python
# åœ¨ emberguard/pipeline.py ä¸­ä¿®æ”¹
results = self.yolo_model(frame, conf=conf_threshold, imgsz=640, verbose=False)
# æ”¹ä¸º
results = self.yolo_model(frame, conf=conf_threshold, imgsz=320, verbose=False)
```

### 3. å‡å°‘åºåˆ—é•¿åº¦

ä¿®æ”¹LSTMåºåˆ—é•¿åº¦ï¼š
```bash
# ä»30å¸§å‡å°‘åˆ°15å¸§
python scripts/8_detect_with_lstm.py --source video.mp4
# éœ€è¦ä¿®æ”¹ä»£ç ä¸­çš„ sequence_length=30 ä¸º sequence_length=15
```

---

## æ‰¹é‡æ£€æµ‹

### æ£€æµ‹å¤šä¸ªæ–‡ä»¶

```bash
# åˆ›å»ºæ‰¹é‡æ£€æµ‹è„šæœ¬
for file in test_picture/*.jpg; do
    python scripts/8_detect_with_lstm.py --source "$file" --output "results/$(basename $file)"
done
```

### æ£€æµ‹æ•´ä¸ªç›®å½•

```bash
# Windows PowerShell
Get-ChildItem test_picture\*.jpg | ForEach-Object {
    python scripts/8_detect_with_lstm.py --source $_.FullName --output "results\$($_.Name)"
}
```

---

## ä¸‹ä¸€æ­¥

1. **è®­ç»ƒæ›´å¥½çš„æ¨¡å‹**
   ```bash
   # ç¬¬äºŒè½®è®­ç»ƒï¼ˆæé«˜Fireè¯†åˆ«ç‡ï¼‰
   python scripts/4_train_lstm.py --epochs 50
   ```

2. **é›†æˆåˆ°GUI**
   - ä¿®æ”¹ `UI/detection_processor.py`
   - æ·»åŠ LSTMé€‰é¡¹å¼€å…³
   - å®æ—¶æ˜¾ç¤ºLSTMé¢„æµ‹

3. **éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ**
   - æ¨¡å‹é‡åŒ–
   - è¾¹ç¼˜è®¾å¤‡é€‚é…
   - APIæœåŠ¡å°è£…

---

**æ€»ç»“**: ä½¿ç”¨ `scripts/8_detect_with_lstm.py` å¯ä»¥å¿«é€Ÿæ£€æµ‹å›¾ç‰‡ã€è§†é¢‘å’Œæ‘„åƒå¤´ï¼Œæ”¯æŒYOLO+LSTMåŒæ¨¡å‹æ¶æ„ï¼Œæä¾›æ›´é«˜çš„æ£€æµ‹å‡†ç¡®ç‡ã€‚
