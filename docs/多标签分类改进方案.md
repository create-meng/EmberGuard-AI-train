# LSTM多标签分类改进方案

## 🔍 当前问题

### 问题1：单标签分类的局限性
**当前设计**：
```
输出: [无火, 烟雾, 火焰] - 只能选一个
标签: 0=无火, 1=烟雾, 2=火焰
```

**问题**：
- 火焰和烟雾经常同时出现
- 但只能标记为"火焰"（标签2）
- 丢失了"同时有烟雾"的信息

### 问题2：数据标注不精确
**当前标注**：
- `fire/` 目录 → 标签2（火焰）
- 但这些视频可能既有火又有烟
- 没有区分"只有火"和"火+烟"

---

## 💡 解决方案

### 方案A：4类单标签分类（简单）

**新类别定义**：
```
0: 无火无烟 (Normal)
1: 只有烟雾 (Smoke Only)
2: 只有火焰 (Fire Only)
3: 火焰+烟雾 (Fire + Smoke)
```

**优点**：
- ✅ 改动小，只需重新标注数据
- ✅ 保持单标签分类架构
- ✅ 能区分混合场景

**缺点**：
- ⚠️ 需要重新标注240个视频
- ⚠️ 类别3的数据可能很少

**实施步骤**：
1. 手动检查240个视频，重新标注
2. 修改 `scripts/3_prepare_lstm_data.py` 的标签
3. 重新生成训练数据
4. 修改模型输出为4类
5. 重新训练

---

### 方案B：多标签分类（推荐）

**新输出定义**：
```
输出1: 是否有火焰 [0-1]
输出2: 是否有烟雾 [0-1]
```

**示例**：
- 无火无烟: [0, 0]
- 只有烟雾: [0, 1]
- 只有火焰: [1, 0]
- 火焰+烟雾: [1, 1]

**优点**：
- ✅ 更灵活，可以同时检测火和烟
- ✅ 符合实际场景
- ✅ 可以输出概率（如：火焰80%，烟雾60%）

**缺点**：
- ⚠️ 需要修改模型架构
- ⚠️ 需要重新标注数据
- ⚠️ 损失函数改为BCELoss

**实施步骤**：

#### 1. 修改模型架构
```python
# 原来
self.fc2 = nn.Linear(64, 3)  # 3类
loss = nn.CrossEntropyLoss()

# 改为
self.fc2 = nn.Linear(64, 2)  # 2个二分类
loss = nn.BCEWithLogitsLoss()
```

#### 2. 重新标注数据
```python
# 原来
label = 2  # 火焰

# 改为
label = [1, 1]  # [有火, 有烟]
```

#### 3. 修改训练逻辑
```python
# 原来
outputs = model(x)  # (batch, 3)
loss = criterion(outputs, labels)  # labels: (batch,)

# 改为
outputs = model(x)  # (batch, 2)
outputs = torch.sigmoid(outputs)
loss = criterion(outputs, labels)  # labels: (batch, 2)
```

---

### 方案C：保持当前设计（最简单）

**理由**：
- 当前设计已经可用（75%准确率）
- 继续训练可以提升到90%+
- 实际应用中，检测到"火焰"就足够了

**优化建议**：
1. 继续训练到30-50个epoch
2. 调整类别权重，更重视Fire类别
3. 在应用层面处理：检测到火焰 = 最高优先级

---

## 🎯 推荐方案

### 短期（当前）：方案C
- 继续使用当前模型
- 训练到30-50个epoch
- 验证准确率达到90%+
- 先完成项目演示

### 长期（优化）：方案B
- 项目演示后，如果需要更精确的检测
- 重新标注数据为多标签
- 修改模型架构
- 重新训练

---

## 📝 实施计划

### Phase 1: 完成当前训练（推荐）
```bash
# 继续训练
python scripts/4_train_lstm.py --epochs 50 --resume

# 目标：验证准确率 > 90%
```

### Phase 2: 评估效果
- 测试更多场景
- 收集误判案例
- 决定是否需要多标签

### Phase 3: 多标签改进（可选）
- 重新标注数据
- 修改模型架构
- 重新训练

---

## 🔧 快速实施多标签（如果需要）

### 1. 创建新的模型类
```python
class LSTMMultiLabelClassifier(nn.Module):
    def __init__(self, input_size=8, hidden_size=128, num_layers=2):
        super().__init__()
        self.lstm = nn.LSTM(input_size, hidden_size, num_layers, batch_first=True)
        self.fc = nn.Linear(hidden_size, 2)  # 2个输出：火、烟
    
    def forward(self, x):
        lstm_out, _ = self.lstm(x)
        out = self.fc(lstm_out[:, -1, :])
        return torch.sigmoid(out)  # 输出概率
```

### 2. 修改数据标注
```python
# 在 scripts/3_prepare_lstm_data.py 中
def create_sequences(self, features_list, has_fire, has_smoke):
    # label = [has_fire, has_smoke]
    # 例如：火焰视频 → [1, 1]（假设有烟）
    #      烟雾视频 → [0, 1]
    #      正常视频 → [0, 0]
    pass
```

### 3. 修改训练脚本
```python
criterion = nn.BCELoss()  # 二分类交叉熵
# 训练时
outputs = model(x)  # (batch, 2)
loss = criterion(outputs, labels.float())  # labels: (batch, 2)
```

---

## 💭 我的建议

**现在**：
1. 先完成当前模型的训练（50 epochs）
2. 测试效果，看是否满足需求
3. 如果准确率 > 90%，可以先用于演示

**之后**：
1. 如果需要更精确的火/烟区分
2. 再考虑改为多标签分类
3. 重新标注和训练

**原因**：
- 当前模型已经基本可用
- 多标签改进需要大量工作
- 先验证需求再优化

你觉得呢？要现在就改为多标签，还是先完成当前训练？
